#
# Makefile for Narai MUD
#
# For BSD make only. For GNU make use Makefile.

PROG    = mud-narai
INCDIR  = ../include
UTLSRC  = ../utils
OBJDIR  = ./obj
INSTDIR = ../bin

# Rewrite against $(.OBJDIR)
UTLSRC      := ../$(UTLSRC)
OBJDIR      := $(.CURDIR)/$(OBJDIR)
INSTDIR     := ../$(INSTDIR)

.PATH : $(UTLSRC)

# CC      = clang
# CC      = gcc
CC      = cc

# MAKE    = gmake
MAKE    = make
MKDEP   = mkdep 
LD      = $(CC)

OFLAGS  = -O -g -Wall -pipe

INCLUDE = -I../$(INCDIR)

# MFLAGS: SYPARK RETURN_TO_QUIT INIT_BARE_HAND GHOST
#         OldMobileFormat OLD_DAM_MESSAGE OLD_PARRY
#         OLD_MIRROR_IMAGE OldMobAct
#
# MFLAGS    = -DIMO=41 -DRETURN_TO_QUIT
#
# MFLAGS are moved to ../include/utils.h

# Set initial gold and quest in "db.c"
# DFLAGS= -DBETA_TEST
DFLAGS=

CFLAGS  = $(OFLAGS) $(DFLAGS) $(INCLUDE)

LDFLAGS  = -lcrypt

SRCS    = \
	act.comm.c act.informative.c act.movement.c act.obj1.c act.obj2.c \
	act.offensive.c act.other.c act.social.c act.wizard.c board.c comm.c \
	constants.c db.c fight.c guild_command.c guild_constant.c \
	guild_informative.c guild_skills.c handler.c interpreter.c limit.c \
	magic.c magic2.c magic3.c magic_weapon.c mail.c mob_magic.c mobact.c \
	modify.c newcom.c quest.c shop.c spec_assign.c spec_procs.c \
	spec_procs2.c spec_procs3.c spell_parser.c spells1.c spells2.c \
	spells3.c utility.c version.c weather.c daerimsa.c gbisland.c

UTILS       = change_level change_pass chstashform unchstashform check_pass \
              check_player list_player mob_create mob_edit zone_item \
              zone_list zone_print mob_balance check_god fix_noname

SCRIPTS     = runmud.sh killmud.sh

OBJS        = $(SRCS:S/.c$/.o/g)
PROG_BIN    = $(PROG)
U_BINS      = $(UTILS)
CTAGS_SRC   = $(SRCS) $(INCDIR)/*.h

default :    objdir $(PROG_BIN) 

all:    $(PROG_BIN) utils

$(PROG_BIN) : $(OBJS)
	$(LD) -o $@ $> $(LDFLAGS)

objdir:
	if [ ! -d $(OBJDIR) ] ; then mkdir $(OBJDIR); fi

utils : $(U_BINS)

clean:
	- /bin/rm -f $(OBJS) $(UTILS:S/$/.o/g) tags core 
	- /bin/rm -f $(PROG_BIN) $(U_BINS)

install : $(PROG_BIN) $(U_BINS)
	- if [ -x $(INSTDIR)/$(PROG).run ] ; then \
	      /bin/mv -f $(INSTDIR)/$(PROG).run $(INSTDIR)/$(PROG).old ; fi
	/bin/cp -p $(PROG_BIN) $(INSTDIR)/$(PROG).new
	/bin/cp -p $(U_BINS) $(INSTDIR)
	/bin/cp -p $(SCRIPTS:S/^/$(UTLSRC)\//g)  $(INSTDIR)
	/bin/chmod 700 $(SCRIPTS:S/^/$(INSTDIR)\//g)

uninstall :
	- /bin/rm -f $(INSTDIR)/$(PROG).new $(INSTDIR)/$(PROG).run $(INSTDIR)/$(PROG).old
	- /bin/rm -f  $(UTILS:S/^/$(INSTDIR)\//g) $(SCRIPTS:S/^/$(INSTDIR)\//g)

ctags :
	- ctags $(CTAGS_SRC:S/^/..\//g)

depend	: 
	$(MKDEP) $(CFLAGS) $(SRCS:S/^/..\//g)
	$(MKDEP) -a $(CFLAGS) $(UTILS:S/^/$(UTLSRC)\//g:S/$/.c/g)

